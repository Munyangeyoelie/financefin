import{r as n,j as e,u as se,D as K,U as X,S as me,T as re,L as $e,d as ae,B as Le,P as Fe,e as ue,f as Oe,h as Ie,i as Te,N as Re,k as qe,l as ne,m as ze,n as Y,O as xe,o as Me,C as Ue,p as Ge,q as Be,s as he,t as Je,v as He,F as de,w as pe,x as ee,y as Ke,z as Ve,X as H,E as ce,G as Ze,H as Qe,I as We,J as F,K as te,M as Xe}from"./react-vendor-BGPmHQNz.js";import{h as le,R as ge,B as fe,C as ye,X as be,Y as je,T as we,L as Ne,k as ve,F as Se}from"./vendor-DQhFoCHR.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))h(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&h(m)}).observe(document,{childList:!0,subtree:!0});function i(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerPolicy&&(p.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?p.credentials="include":a.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function h(a){if(a.ep)return;a.ep=!0;const p=i(a);fetch(a.href,p)}})();const Ye="https://fbbrglvjsrmprihwwdwm.supabase.co",et="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiYnJnbHZqc3JtcHJpaHd3ZHdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0NzAzMTQsImV4cCI6MjA1NzA0NjMxNH0.cDPXwktTARrteRAubiCxoFWowynSbV78rGKQid2bMjo",G=le(Ye,et),Ce=n.createContext(void 0),tt=({children:c})=>{const[g,i]=n.useState(null),[h,a]=n.useState(null),[p,m]=n.useState(!0),x=async u=>{try{const{data:t,error:l}=await G.from("user").select("*").eq("id",u).single();if(l)throw l;return t}catch(t){return console.error("Error fetching user data:",t),null}};n.useEffect(()=>{(async()=>{m(!0);const{data:{session:t}}=await G.auth.getSession();t!=null&&t.user&&(i(t.user),a(await x(t.user.id)));const{data:{subscription:l}}=G.auth.onAuthStateChange(async(S,d)=>{i((d==null?void 0:d.user)||null),a(d!=null&&d.user?await x(d.user.id):null)});return m(!1),()=>l.unsubscribe()})()},[]);const N=async(u,t)=>{m(!0);try{const{data:l,error:S}=await G.auth.signInWithPassword({email:u,password:t});if(S)throw S;return i(l.user),a(await x(l.user.id)),{error:null}}catch(l){return{error:l}}finally{m(!1)}},b=async(u,t,l,S="user")=>{m(!0);try{const{data:d,error:C}=await G.auth.signUp({email:u,password:t,options:{data:{full_name:l||"",role:S||"user"}}});if(C)throw C;const{error:s}=await G.from("user").insert([{id:d.user.id,email:u,full_name:l||"",role:S||"user",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]);return s?(console.error("Error inserting user data:",s),{error:s}):(i(d.user),a(await x(d.user.id)),{error:null})}catch(d){return{error:d}}finally{m(!1)}},j=async()=>{m(!0);try{await G.auth.signOut(),i(null),a(null)}catch(u){console.error("Logout error:",u)}finally{m(!1)}},f=(h==null?void 0:h.role)==="admin";return e.jsx(Ce.Provider,{value:{user:g,userData:h,loading:p,login:N,signup:b,logout:j,supabase:G,isAdmin:f},children:c})},V=()=>{const c=n.useContext(Ce);if(!c)throw new Error("useAuth must be used within an AuthProvider");return c},st=()=>{const[c,g]=n.useState(""),[i,h]=n.useState(""),[a,p]=n.useState(null),{login:m,isAdmin:x}=V(),N=se(),b=async j=>{if(j.preventDefault(),p(null),!c||!i){p("Please enter both email and password");return}try{await m(c,i),N(x?"/admin-dashboard":"/sales-dashboard")}catch(f){p(f.message||"Invalid email or password")}};return e.jsxs("div",{className:"flex h-screen",children:[e.jsxs("div",{className:"w-1/2 bg-teal-500 text-white p-8 flex flex-col justify-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-white rounded-full"})}),e.jsxs("h1",{className:"text-4xl font-bold uppercase",children:["Filbert",e.jsx("br",{})," Finance"]}),e.jsx("p",{className:"mt-4 text-lg",children:"Access your Finance App and get more profit"}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-full"}),e.jsx("div",{className:"w-12 h-24 bg-teal-300 mt-4"})]})]}),e.jsx("div",{className:"w-1/2 bg-white flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md p-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Login"}),a&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:a}),e.jsxs("form",{onSubmit:b,children:[e.jsx("input",{type:"email",placeholder:"Email Address",value:c,onChange:j=>g(j.target.value),className:"w-full border border-gray-300 p-3 mb-4 rounded",required:!0}),e.jsx("input",{type:"password",placeholder:"Password",value:i,onChange:j=>h(j.target.value),className:"w-full border border-gray-300 p-3 mb-4 rounded",required:!0}),e.jsx("button",{type:"submit",className:"w-full bg-teal-500 text-white py-3 rounded font-bold",children:"Login"})]}),e.jsxs("p",{className:"mt-4 text-gray-600 text-center",children:["Don't have an account?"," ",e.jsx("a",{href:"/signup",className:"text-teal-600",children:"Sign Up"})]})]})})]})},rt=()=>{const[c,g]=n.useState(""),[i,h]=n.useState(""),[a,p]=n.useState(""),[m,x]=n.useState(null),[N,b]=n.useState(null),{signup:j}=V(),f=se(),u=async t=>{if(t.preventDefault(),x(null),b(null),!i||!a||!c){x("Please fill in all fields");return}if(a.length<6){x("Password must be at least 6 characters");return}try{await j(i,a,c),b("Account created successfully. You can now log in."),setTimeout(()=>{f("/login")},2e3)}catch(l){x(l.message||"Failed to create account")}};return e.jsxs("div",{className:"flex h-screen",children:[e.jsxs("div",{className:"w-1/2 bg-teal-500 text-white p-8 flex flex-col justify-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-white rounded-full"})}),e.jsxs("h1",{className:"text-4xl font-bold uppercase",children:["Filbert",e.jsx("br",{})," Finance"]}),e.jsx("p",{className:"mt-4 text-lg",children:"Access your Finance App and get more profit"}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-full"}),e.jsx("div",{className:"w-12 h-24 bg-teal-300 mt-4"})]})]}),e.jsx("div",{className:"w-1/2 bg-white flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md p-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Create Account"}),m&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:m}),N&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:N}),e.jsxs("form",{onSubmit:u,children:[e.jsx("input",{type:"text",placeholder:"Full Name",value:c,onChange:t=>g(t.target.value),className:"w-full border border-gray-300 p-3 mb-4 rounded",required:!0}),e.jsx("input",{type:"email",placeholder:"Email Address",value:i,onChange:t=>h(t.target.value),className:"w-full border border-gray-300 p-3 mb-4 rounded",required:!0}),e.jsx("input",{type:"password",placeholder:"Password",value:a,onChange:t=>p(t.target.value),className:"w-full border border-gray-300 p-3 mb-4 rounded",required:!0}),e.jsx("button",{type:"submit",className:"w-full bg-teal-500 text-white py-3 rounded font-bold",children:"Create Account"})]}),e.jsxs("p",{className:"mt-4 text-gray-600 text-center",children:["Already have an account?"," ",e.jsx("a",{href:"/login",className:"text-teal-600",children:"Login"})]})]})})]})},at=({icon:c,title:g,value:i,trend:h})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:g}),e.jsx("h3",{className:"text-2xl font-semibold mt-1",children:i})]}),e.jsx("div",{className:"h-12 w-12 bg-blue-50 rounded-full flex items-center justify-center",children:e.jsx(c,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("p",{className:"text-sm mt-4",children:[e.jsxs("span",{className:`${h>=0?"text-green-500":"text-red-500"}`,children:[h>=0?"+":"",h,"%"]})," ","vs last month"]})]}),nt=()=>{const c=[{icon:K,title:"Total Revenue",value:"Frw 54,234",trend:12.5},{icon:X,title:"Total Customers",value:"2,420",trend:8.1},{icon:me,title:"Total Orders",value:"1,210",trend:-3.2},{icon:re,title:"Growth Rate",value:"15.2%",trend:4.8}];return e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Dashboard Overview"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:c.map((g,i)=>e.jsx(at,{...g},i))})]})},lt=()=>{const c=[{path:"/admin-dashboard",icon:$e,label:"Admin Dashboard"},{path:"/sales-dashboard",icon:ae,label:"Sales Dashboard"},{path:"/companies",icon:Le,label:"Companies"},{path:"/product-list",icon:Fe,label:"Product List"},{path:"/expired-products",icon:ue,label:"Expired Products"},{path:"/low-stocks",icon:Oe,label:"Low Stocks"},{path:"/category-list",icon:Ie,label:"Categories"},{path:"/expense-list",icon:Te,label:"Expenses"}];return e.jsxs("aside",{className:"w-64 bg-white shadow-md",children:[e.jsx("div",{className:"p-4",children:e.jsx("h1",{className:"text-2xl font-bold text-blue-600",children:"Filbert stock"})}),e.jsx("nav",{className:"mt-4",children:c.map(g=>e.jsxs(Re,{to:g.path,className:({isActive:i})=>`flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 ${i?"bg-blue-50 text-blue-600":""}`,children:[e.jsx(g.icon,{className:"h-5 w-5 mr-3"}),e.jsx("span",{children:g.label})]},g.path))})]})},ot="https://fbbrglvjsrmprihwwdwm.supabase.co",it="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiYnJnbHZqc3JtcHJpaHd3ZHdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0NzAzMTQsImV4cCI6MjA1NzA0NjMxNH0.cDPXwktTARrteRAubiCxoFWowynSbV78rGKQid2bMjo",k=le(ot,it),dt=()=>{const[c,g]=n.useState([]),[i,h]=n.useState(!1),[a,p]=n.useState(0);n.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:f,error:u}=await k.from("tax_notifications").select("*").order("created_at",{ascending:!1}).limit(5);if(u)throw u;f&&(g(f),p(f.filter(t=>!t.read).length))}catch(f){console.error("Error fetching tax notifications:",f)}},x=async f=>{try{const{error:u}=await k.from("tax_notifications").update({read:!0}).eq("id",f);if(u)throw u;g(t=>t.map(l=>l.id===f?{...l,read:!0}:l)),p(t=>Math.max(0,t-1))}catch(u){console.error("Error marking tax notification as read:",u)}},N=()=>{h(!i)},b=f=>new Date(f).toLocaleDateString(),j=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"frw"}).format(f);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"p-2 rounded-full hover:bg-gray-100 relative",onClick:N,"aria-label":"Tax Notifications",children:[e.jsx(qe,{className:"h-6 w-6 text-gray-600"}),a>0&&e.jsx("span",{className:"absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center",children:a})]}),i&&e.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-md shadow-lg z-10 overflow-hidden",children:[e.jsx("div",{className:"p-3 bg-gray-50 border-b",children:e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Tax Notifications"})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:c.length>0?c.map(f=>e.jsx("div",{className:`p-3 border-b hover:bg-gray-50 cursor-pointer ${f.read?"":"bg-blue-50"}`,onClick:()=>x(f.id),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mr-3",children:e.jsx(K,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["Tax Alert: Order #",f.order_id]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Order Amount:"," ",j(f.order_amount)]}),e.jsxs("p",{className:"text-sm font-semibold text-green-600",children:["9% Tax: ",j(f.tax_amount)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:b(f.created_at)})]}),!f.read&&e.jsx("span",{className:"h-2 w-2 bg-blue-500 rounded-full"})]})},f.id)):e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No tax notifications"})}),e.jsx("div",{className:"p-2 bg-gray-50 border-t text-center",children:e.jsx("button",{className:"text-xs text-blue-600 hover:text-blue-800",children:"View all tax notifications"})})]})]})},ct=()=>{const{currentUser:c,logout:g}=V()||{currentUser:null,logout:()=>{}},[i,h]=n.useState("");n.useEffect(()=>{(async()=>{if(c!=null&&c.id)try{const{data:m,error:x}=await k.from("users").select("full_name").eq("id",c.id).single();if(x)throw x;h((m==null?void 0:m.full_name)||"")}catch(m){console.error("Error fetching user data:",m.message)}})()},[c]);const a=i||(c==null?void 0:c.email)||"Guest";return e.jsx("header",{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search...",className:"w-64 pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(ne,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(dt,{}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(ze,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Hello, ",a]})]}),e.jsx("button",{onClick:g,className:"text-sm text-gray-600 hover:text-gray-800",children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{to:"/login",className:"text-sm text-gray-600 hover:text-gray-800",children:"Logout"}),e.jsx(Y,{to:"/signup",className:"px-4 py-2 text-sm font-medium text-white bg-blue-500 rounded-md hover:bg-blue-600",children:"Sign Up"})]})]})]})})},mt=()=>e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(lt,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ct,{}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-100",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(xe,{})})})]})]}),ut=({icon:c,title:g,value:i,trend:h,bgColor:a="bg-blue-50",iconColor:p="text-blue-600"})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:g}),e.jsx("h3",{className:"text-2xl font-semibold mt-1",children:i})]}),e.jsx("div",{className:`h-12 w-12 ${a} rounded-full flex items-center justify-center`,children:e.jsx(c,{className:`h-6 w-6 ${p}`})})]}),e.jsxs("p",{className:"text-sm mt-4",children:[e.jsxs("span",{className:h>=0?"text-green-500":"text-red-500",children:[h>=0?"+":"",h,"%"]})," ","vs last month"]})]}),xt=()=>{const[c,g]=n.useState(0),[i,h]=n.useState(0),[a,p]=n.useState(0),[m,x]=n.useState([]),[N,b]=n.useState([]),[j,f]=n.useState([]),[u,t]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const{data:C,error:s}=await k.from("orders").select("*").order("created_at",{ascending:!1});if(s)throw s;const{data:_,error:A}=await k.from("expenses").select("*").order("created_at",{ascending:!1});if(A)throw A;if(C){const $=C.reduce((w,v)=>w+(v.total_amount||0),0);g($),h(C.length),b(C);const o=C.reduce((w,v)=>{if(!v.created_at)return w;const E=new Date(v.created_at).toISOString().split("T")[0];return w[E]=(w[E]||0)+(v.total_amount||0),w},{}),y=Object.entries(o).map(([w,v])=>({date:w,amount:v,displayDate:new Date(w).toLocaleDateString("en-US",{month:"short",day:"numeric"})})).sort((w,v)=>new Date(w.date).getTime()-new Date(v.date).getTime());x(y)}_&&f(_);const D=new Set;C==null||C.forEach($=>{$.customer_name&&D.add($.customer_name)}),p(D.size),t(!1)}catch(C){console.error("Error fetching dashboard data:",C),t(!1)}})()},[]);const l=[{icon:K,title:"Total Revenue",value:`Frw ${c.toLocaleString()}`,trend:12.5,bgColor:"bg-green-50",iconColor:"text-green-600"},{icon:X,title:"Total Customers",value:a.toLocaleString(),trend:8.1,bgColor:"bg-purple-50",iconColor:"text-purple-600"},{icon:ae,title:"Total Orders",value:i.toLocaleString(),trend:-3.2,bgColor:"bg-orange-50",iconColor:"text-orange-600"},{icon:re,title:"Growth Rate",value:"15.2%",trend:4.8,bgColor:"bg-blue-50",iconColor:"text-blue-600"}],S=()=>{try{let d="\uFEFF";d+=`SUMMARY DATA\r
`,d+=`Metric,Value,Trend vs Last Month,Details\r
`,d+=`Total Revenue,Frw ${c.toLocaleString()},${l[0].trend}%,\r
`,d+=`Total Customers,${a.toLocaleString()},${l[1].trend}%,\r
`,d+=`Total Orders,${i.toLocaleString()},${l[2].trend}%,\r
`,d+=`Growth Rate,${l[3].value},${l[3].trend}%,\r
`,d+=`\r
`,d+=`ORDERS DATA\r
`,d+=`Order ID,Date,Customer,Total Amount,Status,Payment Method,Additional Info\r
`,N&&N.length>0?N.forEach(s=>{const _=s.customer_name?`"${s.customer_name.replace(/"/g,'""')}"`:"N/A",A=s.notes?`"${s.notes.replace(/"/g,'""')}"`:"",D=s.status?`"${s.status}"`:"N/A",$=s.payment_method?`"${s.payment_method}"`:"N/A";d+=[s.id||"N/A",new Date(s.created_at).toLocaleString(),_,`Frw ${s.total_amount.toLocaleString()}`,D,$,A].join(",")+`\r
`}):d+=`No order data available\r
`,d+=`\r
`,d+=`EXPENSES DATA\r
`,d+=`Expense ID,Date,Category,Amount,Vendor,Description\r
`,j&&j.length>0?j.forEach(s=>{const _=s.category?`"${s.category.replace(/"/g,'""')}"`:"N/A",A=s.description?`"${s.description.replace(/"/g,'""')}"`:"",D=s.vendor?`"${s.vendor.replace(/"/g,'""')}"`:"N/A";d+=[s.id||"N/A",new Date(s.created_at).toLocaleString(),_,`Frw ${s.amount.toLocaleString()}`,D,A].join(",")+`\r
`}):d+=`No expense data available\r
`,d+=`\r
`,d+=`DAILY SALES BREAKDOWN\r
`,d+=`Date,Total Sales\r
`,m&&m.length>0?m.forEach(s=>{d+=[s.date,`Frw ${s.amount.toLocaleString()}`].join(",")+`\r
`}):d+=`No daily sales data available\r
`;const C=new Blob([d],{type:"text/csv;charset=utf-8;"});Se.saveAs(C,`admin_report_${new Date().toISOString().split("T")[0]}.csv`)}catch(d){console.error("Error generating report:",d),alert("There was an error generating the report. Please try again.")}};return u?e.jsx("div",{className:"flex items-center justify-center h-full",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Admin Dashboard"}),e.jsx("button",{onClick:S,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Download Report"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:l.map((d,C)=>e.jsx(ut,{...d},C))}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Daily Sales Overview"}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(fe,{data:m,children:[e.jsx(ye,{strokeDasharray:"3 3"}),e.jsx(be,{dataKey:"displayDate"}),e.jsx(je,{}),e.jsx(we,{formatter:d=>[`Frw ${d.toLocaleString()}`,"Sales"],labelFormatter:d=>`Date: ${d}`}),e.jsx(Ne,{}),e.jsx(ve,{dataKey:"amount",name:"Sales",fill:"#4F46E5"})]})})})]})]})},ht="https://fbbrglvjsrmprihwwdwm.supabase.co",pt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiYnJnbHZqc3JtcHJpaHd3ZHdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0NzAzMTQsImV4cCI6MjA1NzA0NjMxNH0.cDPXwktTARrteRAubiCxoFWowynSbV78rGKQid2bMjo",J=le(ht,pt),gt=()=>{const[c,g]=n.useState(""),[i,h]=n.useState([]),[a,p]=n.useState(!0),[m,x]=n.useState({totalSales:"Frw 0",totalOrders:"0",totalCustomers:"0",averageSale:"Frw 0",salesGrowth:"+0%",ordersGrowth:"+0%",customersGrowth:"+0%",averageSaleGrowth:"+0%"}),[N,b]=n.useState(!1),[j,f]=n.useState(!1),[u,t]=n.useState(!1),[l,S]=n.useState(null);n.useRef(null);const[d,C]=n.useState({customer_name:"",product:"",order_amount:"",status:"Pending"}),[s,_]=n.useState({id:null,customer_name:"",product:"",order_amount:"",status:"Pending"}),[A,D]=n.useState(!1),[$,o]=n.useState(null),[y,w]=n.useState(1),[v,E]=n.useState(1),[O,z]=n.useState(0),M=8,P=async()=>{p(!0);try{const r=(y-1)*M,I=r+M-1,{data:L,error:Q,count:W}=await J.from("orders").select("*",{count:"exact"}).ilike("customer_name",`%${c}%`).order("created_at",{ascending:!1}).range(r,I);if(Q)throw Q;const B=L.map(U=>({...U,date:new Date(U.created_at).toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"}),customer:U.customer_name,amount:U.order_amount}));h(B),z(W||0),E(Math.ceil(W/M)||1),await R()}catch(r){console.error("Error fetching orders:",r.message)}finally{p(!1)}},R=async()=>{try{const{data:r,error:I}=await J.from("orders").select("order_amount, customer_name");if(I)throw I;if(!r||r.length===0){x({totalSales:"Frw 0",totalOrders:"0",totalCustomers:"0",averageSale:"Frw 0",salesGrowth:"+0%",ordersGrowth:"+0%",customersGrowth:"+0%",averageSaleGrowth:"+0%"});return}const L=r.reduce((B,U)=>{var ie;const oe=typeof U.order_amount=="string"?parseFloat(((ie=U.order_amount.match(/[\d.]+/))==null?void 0:ie[0])||0):parseFloat(U.order_amount||0);return B+(isNaN(oe)?0:oe)},0),Q=new Set(r.filter(B=>B.customer_name).map(B=>B.customer_name)).size,W=r.length>0?L/r.length:0;x({totalSales:`Frw ${L.toFixed(2)}`,totalOrders:r.length.toString(),totalCustomers:Q.toString(),averageSale:`Frw ${W.toFixed(2)}`,salesGrowth:"+8.5%",ordersGrowth:"+5.2%",customersGrowth:"+2.8%",averageSaleGrowth:"-0.5%"})}catch(r){console.error("Error fetching statistics:",r.message)}},T=async()=>{if(!d.customer_name||!d.product||!d.order_amount){alert("Please fill all required fields");return}try{const r=parseFloat(d.order_amount);if(isNaN(r))throw new Error("Amount must be a valid number");const I={customer_name:d.customer_name.trim(),product:d.product.trim(),order_amount:r,total_amount:r,status:d.status,created_at:new Date().toISOString()},{error:L}=await J.from("orders").insert([I]);if(L)throw L;C({customer_name:"",product:"",order_amount:"",status:"Pending"}),b(!1),await P()}catch(r){console.error("Error adding order:",r.message),alert(`Failed to add order: ${r.message}`)}},q=r=>{var L;const I=typeof r.amount=="string"?((L=r.amount.match(/[\d.]+/))==null?void 0:L[0])||"0":r.amount.toString();_({id:r.id,customer_name:r.customer_name||"",product:r.product||"",order_amount:I,status:r.status||"Pending"}),f(!0)},Z=async()=>{if(!s.customer_name||!s.product||!s.order_amount){alert("Please fill all required fields");return}try{const r=parseFloat(s.order_amount);if(isNaN(r))throw new Error("Amount must be a valid number");const I={customer_name:s.customer_name.trim(),product:s.product.trim(),order_amount:r,total_amount:r,status:s.status},{error:L}=await J.from("orders").update(I).eq("id",s.id);if(L)throw L;_({id:null,customer_name:"",product:"",order_amount:"",status:"Pending"}),f(!1),await P()}catch(r){console.error("Error updating order:",r.message),alert(`Failed to update order: ${r.message}`)}},De=r=>{S(r),t(!0)},_e=()=>{const r=window.open("","_blank");r.document.write(`
      <html>
        <head>
          <title>Order Invoice #${l.id.toString().padStart(4,"0")}</title>
          <style>
            body { font-family: Arial, sans-serif; }
            .invoice { max-width: 800px; margin: 20px auto; padding: 20px; }
            .header { text-align: center; margin-bottom: 30px; }
            .details div { margin-bottom: 5px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f2f2f2; }
            .total { text-align: right; font-weight: bold; }
          </style>
        </head>
        <body>
          <div class="invoice">
            <div class="header">
              <h1>Order Invoice</h1>
              <p>Order #${l.id.toString().padStart(4,"0")}</p>
              <p>Date: ${l.date}</p>
            </div>
            <div class="details">
              <div><strong>Customer:</strong> ${l.customer_name||l.customer}</div>
              <div><strong>Status:</strong> ${l.status}</div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>${l.product}</td>
                  <td>${l.amount}</td>
                </tr>
              </tbody>
            </table>
            <div class="total">Total: ${l.amount}</div>
          </div>
        </body>
      </html>
    `),r.document.close(),r.focus(),r.print(),r.close(),t(!1)},ke=async()=>{if($)try{const{error:r}=await J.from("orders").delete().eq("id",$);if(r)throw r;D(!1),o(null),await P()}catch(r){console.error("Error deleting order:",r.message),alert(`Failed to delete order: ${r.message}`)}};n.useEffect(()=>{P()},[c,y]);const Ae=[{id:1,title:"Total Sales",value:m.totalSales,growth:m.salesGrowth,positive:!m.salesGrowth.includes("-"),icon:e.jsx(K,{className:"text-purple-700",size:20}),bgColor:"bg-purple-100"},{id:2,title:"Total Orders",value:m.totalOrders,growth:m.ordersGrowth,positive:!m.ordersGrowth.includes("-"),icon:e.jsx(me,{className:"text-blue-700",size:20}),bgColor:"bg-blue-100"},{id:3,title:"Customers",value:m.totalCustomers,growth:m.customersGrowth,positive:!m.customersGrowth.includes("-"),icon:e.jsx(X,{className:"text-green-700",size:20}),bgColor:"bg-green-100"},{id:4,title:"Average Sale",value:m.averageSale,growth:m.averageSaleGrowth,positive:!m.averageSaleGrowth.includes("-"),icon:e.jsx(Me,{className:"text-red-700",size:20}),bgColor:"bg-red-100"}],Ee=r=>{switch(r){case"Paid":return"bg-green-100 text-green-700 border-green-300";case"Pending":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"Delivered":return"bg-blue-100 text-blue-700 border-blue-300";case"Cancelled":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},Pe=()=>{const r=[];if(v<=3)for(let L=1;L<=v;L++)r.push(L);else r.push(1),y>2&&r.push("..."),y!==1&&y!==v&&r.push(y),y<v-1&&r.push("..."),r.push(v);return r};return e.jsxs("div",{className:"bg-gray-100 min-h-screen",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Orders"}),e.jsx("nav",{className:"text-sm mt-1",children:e.jsxs("ol",{className:"list-none p-0 inline-flex",children:[e.jsxs("li",{className:"flex items-center text-gray-500",children:[e.jsx("a",{href:"#",className:"text-purple-600",children:"Dashboard"}),e.jsx("span",{className:"mx-2",children:"/"})]}),e.jsx("li",{className:"flex items-center text-gray-500",children:"Orders"})]})})]}),e.jsxs("div",{className:"flex mt-4 md:mt-0 space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-white border border-gray-300 rounded-md flex items-center text-gray-700 hover:bg-gray-50",children:[e.jsx(Ue,{size:18,className:"mr-2"}),e.jsx("span",{children:"Mar 01, 2025 - Mar 31, 2025"}),e.jsx(Ge,{size:18,className:"ml-2"})]}),e.jsxs("button",{className:"px-4 py-2 bg-white border border-gray-300 rounded-md flex items-center text-gray-700 hover:bg-gray-50",children:[e.jsx(Be,{size:18,className:"mr-2"}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-md flex items-center hover:bg-purple-700",onClick:()=>b(!0),children:[e.jsx(he,{size:18,className:"mr-2"}),e.jsx("span",{children:"Add New"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:Ae.map(r=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-full ${r.bgColor} mr-4`,children:r.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:r.title}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mt-1",children:r.value})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:`flex items-center ${r.positive?"text-green-600":"text-red-600"}`,children:[r.positive?e.jsx(Je,{size:16,className:"mr-1"}):e.jsx(He,{size:16,className:"mr-1"}),e.jsx("span",{children:r.growth}),e.jsx("span",{className:"text-gray-500 ml-2 text-sm",children:"Since last month"})]})})]},r.id))}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4 md:mb-0",children:"Orders List"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative mr-3",children:[e.jsx("input",{type:"text",placeholder:"Search...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 w-full",value:c,onChange:r=>g(r.target.value)}),e.jsx(ne,{className:"absolute left-3 top-2.5 text-gray-400",size:18})]}),e.jsx("button",{className:"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",onClick:P,children:"Search"})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:a?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-600"})}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.length>0?i.map(r=>{var I,L;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-purple-600",children:["#",((I=r.id)==null?void 0:I.toString().padStart(4,"0"))||"0000"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-700 font-medium mr-3",children:((L=r.customer)==null?void 0:L.charAt(0))||"?"}),r.customer||"Unknown"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800",children:r.product||"No product"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800",children:r.amount||"Frw 0.00"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 text-xs rounded-full border ${Ee(r.status)}`,children:r.status||"Unknown"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.date||"No date"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{className:"text-gray-500 hover:text-blue-600",onClick:()=>De(r),title:"Print Order",children:e.jsx(de,{size:18})}),e.jsx("button",{className:"text-gray-500 hover:text-green-600",onClick:()=>q(r),title:"Edit Order",children:e.jsx(pe,{size:18})}),e.jsx("button",{className:"text-gray-500 hover:text-red-600",onClick:()=>{o(r.id),D(!0)},children:e.jsx(ee,{size:18})})]})})]},r.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"No orders found"})})})]})}),i.length>0&&e.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(y-1)*M+1," to"," ",Math.min(y*M,O)," of"," ",O," entries"]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{className:"px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50 disabled:opacity-50",onClick:()=>w(r=>Math.max(r-1,1)),disabled:y===1,children:e.jsx(Ke,{size:16})}),Pe().map((r,I)=>e.jsx("button",{className:`px-3 py-1 ${r===y?"bg-purple-600 text-white":"border border-gray-300 text-gray-500"} rounded hover:bg-purple-700 hover:text-white ${r==="..."?"cursor-default hover:bg-white hover:text-gray-500":""}`,onClick:()=>r!=="..."&&w(r),disabled:r==="...",children:r},I)),e.jsx("button",{className:"px-3 py-1 border border-gray-300 rounded text-gray-500 hover:bg-gray-50 disabled:opacity-50",onClick:()=>w(r=>Math.min(r+1,v)),disabled:y===v,children:e.jsx(Ve,{size:16})})]})]})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Add New Order"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:()=>b(!1),children:e.jsx(H,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Customer Name*"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:d.customer_name,onChange:r=>C({...d,customer_name:r.target.value}),placeholder:"Enter customer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Product*"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:d.product,onChange:r=>C({...d,product:r.target.value}),placeholder:"Enter product name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Amount*"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:d.order_amount,onChange:r=>C({...d,order_amount:r.target.value}),placeholder:"Enter amount (e.g. 99.99)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:d.status,onChange:r=>C({...d,status:r.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",onClick:()=>b(!1),children:"Cancel"}),e.jsxs("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 flex items-center",onClick:T,children:[e.jsx(ce,{size:18,className:"mr-2"}),"Add Order"]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Edit Order"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:()=>f(!1),children:e.jsx(H,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Customer Name*"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:s.customer_name,onChange:r=>_({...s,customer_name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Product*"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:s.product,onChange:r=>_({...s,product:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Amount*"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:s.order_amount,onChange:r=>_({...s,order_amount:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",value:s.status,onChange:r=>_({...s,status:r.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",onClick:()=>f(!1),children:"Cancel"}),e.jsxs("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 flex items-center",onClick:Z,children:[e.jsx(ce,{size:18,className:"mr-2"}),"Update Order"]})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Print Order"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:()=>t(!1),children:e.jsx(H,{size:20})})]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to print Order #",l==null?void 0:l.id.toString().padStart(4,"0"),"?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",onClick:()=>t(!1),children:"Cancel"}),e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",onClick:_e,children:[e.jsx(de,{size:18,className:"mr-2"}),"Print"]})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Confirm Delete"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:()=>{D(!1),o(null)},children:e.jsx(H,{size:20})})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this order? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",onClick:()=>{D(!1),o(null)},children:"Cancel"}),e.jsxs("button",{className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",onClick:ke,children:[e.jsx(ee,{size:18,className:"mr-2"}),"Delete"]})]})]})})]})},ft=()=>{const[c,g]=n.useState([]),[i,h]=n.useState({name:"",contact_person:"",email:"",phone:"",address:""}),[a,p]=n.useState(!0),[m,x]=n.useState(null),[N,b]=n.useState(!1);n.useEffect(()=>{j()},[]);const j=async()=>{try{p(!0);const{data:t,error:l}=await k.from("companies").select("*").order("name");if(l)throw l;g(t||[])}catch(t){console.error("Error fetching companies:",t),x("Failed to load companies")}finally{p(!1)}},f=async t=>{if(t.preventDefault(),!i.name.trim()){x("Company name is required");return}try{b(!0);const{data:l,error:S}=await k.from("companies").insert([{name:i.name.trim(),contact_person:i.contact_person.trim(),email:i.email.trim(),phone:i.phone.trim(),address:i.address.trim()}]).select();if(S)throw S;g([...l||[],...c]),h({name:"",contact_person:"",email:"",phone:"",address:""}),x(null),j()}catch(l){console.error("Error adding company:",l),x("Failed to add company")}finally{b(!1)}},u=async t=>{if(confirm("Are you sure you want to delete this company?"))try{const{error:l}=await k.from("companies").delete().eq("id",t);if(l)throw l;g(c.filter(S=>S.id!==t))}catch(l){console.error("Error deleting company:",l),x("Failed to delete company")}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Branch Management"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Add New Branch"}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Branch Name"}),e.jsx("input",{type:"text",id:"name",value:i.name,onChange:t=>h({...i,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Branch  name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",id:"contact_person",value:i.contact_person,onChange:t=>h({...i,contact_person:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contact person name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:i.email,onChange:t=>h({...i,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",value:i.phone,onChange:t=>h({...i,phone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Phone number"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{id:"address",value:i.address,onChange:t=>h({...i,address:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Branch address",rows:3})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",disabled:N,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:N?"Adding...":"Add Branch"})})]}),m&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Branch"}),a?e.jsx("p",{children:"Loading companies..."}):c.length===0?e.jsx("p",{className:"text-gray-500",children:"No Clients found. Add your first Client above."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Person"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.contact_person||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.email||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.phone||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:e.jsx("button",{onClick:()=>u(t.id),className:"text-red-600 hover:text-red-800",children:"Delete"})})]},t.id))})]})})]})]})},yt=()=>{const[c,g]=n.useState([]),[i,h]=n.useState(!0),[a,p]=n.useState(""),[m,x]=n.useState(null),[N,b]=n.useState({}),[j,f]=n.useState(""),[u,t]=n.useState("");n.useEffect(()=>{l()},[]);const l=async()=>{try{const{data:o,error:y}=await k.from("products").select(`
          *,
          categories (
            name
          )
        `).order("created_at",{ascending:!1});if(y)throw y;g(o||[]),h(!1)}catch(o){console.error("Error fetching products:",o),h(!1)}},S=async o=>{if(window.confirm("Are you sure you want to delete this product?"))try{const{error:y}=await k.from("products").delete().eq("id",o);if(y)throw y;g(c.filter(w=>w.id!==o))}catch(y){console.error("Error deleting product:",y)}},d=o=>{x(o.id),b({name:o.name,sku:o.sku,price:o.price,quantity:o.quantity})},C=(o,y)=>{b(w=>({...w,[o]:y}))},s=async o=>{try{const{error:y}=await k.from("products").update({name:N.name,sku:N.sku,price:N.price,quantity:N.quantity}).eq("id",o);if(y)throw y;g(c.map(w=>w.id===o?{...w,...N}:w)),x(null),b({})}catch(y){console.error("Error updating product:",y)}},_=()=>{x(null),b({})},A=c.filter(o=>{var y;return o.name.toLowerCase().includes(a.toLowerCase())||((y=o.sku)==null?void 0:y.toLowerCase().includes(a.toLowerCase()))}),D=o=>{var w;const y=window.open("","_blank");y&&(y.document.write(`
        <html>
          <head>
            <title>Product Details</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h2 { text-align: center; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>Product Details</h2>
            <table>
              <tr><th>ID</th><td>${o.id}</td></tr>
              <tr><th>Name</th><td>${o.name}</td></tr>
              <tr><th>SKU</th><td>${o.sku}</td></tr>
              <tr><th>Category</th><td>${(w=o.categories)==null?void 0:w.name}</td></tr>
              <tr><th>Price</th><td>frw ${o.price.toFixed(2)}</td></tr>
              <tr><th>Quantity</th><td>${o.quantity}</td></tr>
            </table>
            <script>window.print(); window.close();<\/script>
          </body>
        </html>
      `),y.document.close())},$=()=>{const y=[...c].sort((v,E)=>new Date(v.created_at).getTime()-new Date(E.created_at).getTime()).filter(v=>{const E=new Date(v.created_at),O=j?new Date(j):null,z=u?new Date(u):null;return O&&z?E>=O&&E<=z:O?E>=O:z?E<=z:!0}),w=window.open("","_blank");w&&(w.document.write(`
        <html>
          <head>
            <title>All Product Transactions</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h2 { text-align: center; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>All Product Transactions (${j||"Start"} to ${u||"End"})</h2>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>SKU</th>
                  <th>Category</th>
                  <th>Price</th>
                  <th>Quantity</th>
                </tr>
              </thead>
              <tbody>
                ${y.map(v=>{var E;return`
                      <tr>
                        <td>${v.id}</td>
                        <td>${v.name}</td>
                        <td>${v.sku}</td>
                        <td>${(E=v.categories)==null?void 0:E.name}</td>
                        <td>frw ${v.price.toFixed(2)}</td>
                        <td>${v.quantity}</td>
                      </tr>
                    `}).join("")}
              </tbody>
            </table>
            <script>window.print(); window.close();<\/script>
          </body>
        </html>
      `),w.document.close())};return i?e.jsx("div",{className:"flex items-center justify-center h-full",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Product List"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("input",{type:"date",value:j,onChange:o=>f(o.target.value),className:"border p-2 rounded w-full",placeholder:"Start Date"}),e.jsx("input",{type:"date",value:u,onChange:o=>t(o.target.value),className:"border p-2 rounded w-full",placeholder:"End Date"}),e.jsx("button",{onClick:$,className:"bg-purple-500 text-white p-2 rounded hover:bg-purple-600",children:"Print All Products"}),e.jsxs(Y,{to:"/add-product",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Add Product"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:o=>p(o.target.value)}),e.jsx(ne,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(o=>{var y;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m===o.id?e.jsx("input",{type:"text",value:N.name||"",onChange:w=>C("name",w.target.value),className:"border rounded px-2 py-1 w-full"}):e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0",children:e.jsx("img",{className:"h-10 w-10 rounded-full",src:`https://source.unsplash.com/100x100/?product&random=${o.id}`,alt:o.name})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:m===o.id?e.jsx("input",{type:"text",value:N.sku||"",onChange:w=>C("sku",w.target.value),className:"border rounded px-2 py-1 w-full"}):o.sku}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(y=o.categories)==null?void 0:y.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:m===o.id?e.jsx("input",{type:"number",value:N.price||"",onChange:w=>C("price",Number(w.target.value)),className:"border rounded px-2 py-1 w-full"}):`frw ${o.price.toFixed(2)}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:m===o.id?e.jsx("input",{type:"number",value:N.quantity||"",onChange:w=>C("quantity",Number(w.target.value)),className:"border rounded px-2 py-1 w-full"}):o.quantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("div",{className:"flex space-x-2",children:m===o.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(o.id),className:"text-green-600 hover:text-green-900",title:"Save changes",children:e.jsx(Ze,{className:"h-5 w-5"})}),e.jsx("button",{onClick:_,className:"text-gray-600 hover:text-gray-900",title:"Cancel editing",children:e.jsx(H,{className:"h-5 w-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(o),className:"text-blue-600 hover:text-blue-900",title:"Edit product",children:e.jsx(pe,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>S(o.id),className:"text-red-600 hover:text-red-900",title:"Delete product",children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>D(o),className:"text-green-600 hover:text-green-900",title:"Print product",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10a2 2 0 002-2z"})})})]})})})]},o.id)})})]})})]})]})},bt=()=>{const c=se(),[g,i]=n.useState([]),[h,a]=n.useState([]),[p,m]=n.useState(!1),[x,N]=n.useState({name:"",description:"",category_id:"",company_id:"",sku:"",price:"",cost_price:"",quantity:"",expiry_date:""});n.useEffect(()=>{b(),j()},[]);const b=async()=>{try{const{data:t}=await k.from("categories").select("*");i(t||[])}catch(t){console.error("Error fetching categories:",t)}},j=async()=>{try{const{data:t}=await k.from("companies").select("*");a(t||[])}catch(t){console.error("Error fetching companies:",t)}},f=t=>{const{name:l,value:S}=t.target;N(d=>({...d,[l]:S}))},u=async t=>{t.preventDefault(),m(!0);try{const{error:l}=await k.from("products").insert([{...x,price:parseFloat(x.price),cost_price:parseFloat(x.cost_price),quantity:parseInt(x.quantity)}]);if(l)throw l;c("/product-list")}catch(l){console.error("Error adding product:",l)}finally{m(!1)}};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Add New Product"})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Name"}),e.jsx("input",{type:"text",name:"name",required:!0,value:x.name,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SKU"}),e.jsx("input",{type:"text",name:"sku",value:x.sku,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"category_id",required:!0,value:x.category_id,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Category"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company"}),e.jsxs("select",{name:"company_id",required:!0,value:x.company_id,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Company"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price"}),e.jsx("input",{type:"number",name:"price",required:!0,min:"0",step:"0.01",value:x.price,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price"}),e.jsx("input",{type:"number",name:"cost_price",required:!0,min:"0",step:"0.01",value:x.cost_price,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",name:"quantity",required:!0,min:"0",value:x.quantity,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date"}),e.jsx("input",{type:"date",name:"expiry_date",value:x.expiry_date,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",rows:4,value:x.description,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>c("/product-list"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:p?"Adding...":"Add Product"})]})]})})]})},jt=()=>{const[c,g]=n.useState([]),[i,h]=n.useState(!0),[a,p]=n.useState(null),[m,x]=n.useState("");n.useEffect(()=>{N()},[]);const N=async()=>{try{h(!0);const u=new Date;u.setDate(u.getDate()+7);const{data:t,error:l}=await k.from("products").select(`
          *,
          category:category_id(name),
          company:company_id(name)
        `).lte("expiry_date",u.toISOString().split("T")[0]).order("expiry_date",{ascending:!0});if(l)throw l;g(t||[])}catch(u){console.error("Error fetching products:",u),p("Failed to load products")}finally{h(!1)}},b=async u=>{if(confirm("Are you sure you want to delete this product?"))try{const{error:t}=await k.from("products").delete().eq("id",u);if(t)throw t;g(c.filter(l=>l.id!==u))}catch(t){console.error("Error deleting product:",t),p("Failed to delete product")}},j=c.filter(u=>{var t,l,S;return u.name.toLowerCase().includes(m.toLowerCase())||((t=u.sku)==null?void 0:t.toLowerCase().includes(m.toLowerCase()))||((l=u.category)==null?void 0:l.name.toLowerCase().includes(m.toLowerCase()))||((S=u.company)==null?void 0:S.name.toLowerCase().includes(m.toLowerCase()))}),f=u=>{const t=new Date,S=new Date(u).getTime()-t.getTime(),d=Math.ceil(S/(1e3*60*60*24));return d<0?{status:"expired",days:Math.abs(d),color:"bg-red-100 text-red-800"}:d<=7?{status:"warning",days:d,color:"bg-yellow-100 text-yellow-800"}:{status:"normal",days:d,color:"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"px-4 py-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Expired Products"}),e.jsx("div",{className:"mt-4 lg:mt-0 w-full lg:w-auto",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative w-full lg:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search products...",className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:m,onChange:u=>x(u.target.value)}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})})})]}),a&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-6",children:a}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):j.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:m?"No products found matching your search.":"No expiring products found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Brand"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expiry Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(u=>{var d,C,s;const{status:t,days:l,color:S}=f(u.expiry_date);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gray-200 rounded-md flex items-center justify-center text-gray-500",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.name}),e.jsx("div",{className:"text-sm text-gray-500",children:((d=u.description)==null?void 0:d.substring(0,50))||""})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u.sku||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((C=u.category)==null?void 0:C.name)||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((s=u.company)==null?void 0:s.name)||"-"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["Rwf ",u.price.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u.quantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S}`,children:new Date(u.expiry_date).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("span",{className:S,children:t==="expired"?`${l} days expired`:`${l} days remaining`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm",children:e.jsx("button",{onClick:()=>b(u.id),className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},u.id)})})]})})})]})},wt=()=>{const{supabase:c}=V(),[g,i]=n.useState([]),[h,a]=n.useState(!0),[p,m]=n.useState(null),x=20;n.useEffect(()=>{async function b(){try{a(!0);const{data:j,error:f}=await c.from("products").select("*").lt("quantity",x).order("quantity",{ascending:!0});if(f)throw f;i(j||[])}catch(j){console.error("Error fetching low stock items:",j),m("Failed to load low stock items. Please try again later.")}finally{a(!1)}}b()},[c]);const N=b=>b<=7?"bg-red-100 text-red-600":b<=20?"bg-orange-100 text-orange-600":"bg-yellow-100 text-yellow-600";return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Low Stocks"}),e.jsx("button",{className:"text-blue-600 hover:text-blue-800 font-medium",children:"View All"})]}),h?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):p?e.jsxs("div",{className:"flex items-center justify-center p-4 text-red-500",children:[e.jsx(ue,{className:"mr-2 h-5 w-5"}),e.jsx("p",{children:p})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Brand"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Qty"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-4 text-center text-gray-500",children:"No low stock items found"})}):g.map(b=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 mr-3",children:e.jsx("img",{src:b.image_url||"/api/placeholder/40/40",alt:b.product_name,className:"h-10 w-10 rounded-md object-cover"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:b.product_name})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:b.sku}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:b.category}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:b.brand}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:["Rwf",b.price.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:b.unit}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${N(b.quantity)}`,children:b.quantity})})]},b.id))})]})})]})},Nt=()=>{const[c,g]=n.useState([]),[i,h]=n.useState({name:"",description:""}),[a,p]=n.useState(!0),[m,x]=n.useState(null),[N,b]=n.useState(!1);n.useEffect(()=>{j()},[]);const j=async()=>{try{p(!0);const{data:t,error:l}=await k.from("categories").select("*").order("name");if(l)throw l;g(t||[])}catch(t){console.error("Error fetching categories:",t),x("Failed to load categories")}finally{p(!1)}},f=async t=>{if(t.preventDefault(),!i.name.trim()){x("Category name is required");return}try{b(!0);const{data:l,error:S}=await k.from("categories").insert([{name:i.name.trim(),description:i.description.trim()}]).select();if(S)throw S;g([...l||[],...c]),h({name:"",description:""}),x(null),j()}catch(l){console.error("Error adding category:",l),x("Failed to add category")}finally{b(!1)}},u=async t=>{if(confirm("Are you sure you want to delete this category?"))try{const{error:l}=await k.from("categories").delete().eq("id",t);if(l)throw l;g(c.filter(S=>S.id!==t))}catch(l){console.error("Error deleting category:",l),x("Failed to delete category")}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Category Management"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Add New Category"}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",id:"name",value:i.name,onChange:t=>h({...i,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Category name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",id:"description",value:i.description,onChange:t=>h({...i,description:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional description"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",disabled:N,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:N?"Adding...":"Add Category"})})]}),m&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Categories"}),a?e.jsx("p",{children:"Loading categories..."}):c.length===0?e.jsx("p",{className:"text-gray-500",children:"No categories found. Add your first category above."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.description||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:e.jsx("button",{onClick:()=>u(t.id),className:"text-red-600 hover:text-red-800",children:"Delete"})})]},t.id))})]})})]})]})},vt=()=>e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Manage Stocks"})}),St=()=>e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Phone Orders"})}),Ct=()=>e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Sales Returns"})}),Dt=()=>{const[c,g]=n.useState([]),[i,h]=n.useState({id:"",title:"",amount:0,category:"",reference_number:"",expense_date:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),status:"Pending"}),[a,p]=n.useState(null),[m,x]=n.useState(!1),[N,b]=n.useState(""),[j,f]=n.useState(""),u=async()=>{x(!0);const{data:s,error:_}=await k.from("expenses").select("*").order("created_at",{ascending:!1});_?console.error("Error fetching expenses:",_):g(s||[]),x(!1)},t=async s=>{s.preventDefault(),x(!0);const _={...i,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:A,error:D}=await k.from("expenses").insert([_]).select();D?console.error("Error adding expense:",D):(g([A[0],...c]),h({id:"",title:"",amount:0,category:"",reference_number:"",expense_date:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),status:"Pending"})),x(!1)},l=async s=>{if(s.preventDefault(),!a)return;x(!0);const{data:_,error:A}=await k.from("expenses").update({title:a.title,amount:a.amount,category:a.category,reference_number:a.reference_number,expense_date:a.expense_date,status:a.status,updated_at:new Date().toISOString()}).eq("id",a.id).select();A?console.error("Error updating expense:",A):(g(c.map(D=>D.id===a.id?_[0]:D)),p(null)),x(!1)},S=async s=>{x(!0);const{error:_}=await k.from("expenses").delete().eq("id",s);_?console.error("Error deleting expense:",_):g(c.filter(A=>A.id!==s)),x(!1)},d=s=>{const _=window.open("","_blank");_&&(_.document.write(`
        <html>
          <head>
            <title>Expense Transaction</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h2 { text-align: center; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>Expense Transaction</h2>
            <table>
              <tr><th>ID</th><td>${s.id}</td></tr>
              <tr><th>Title</th><td>${s.title}</td></tr>
              <tr><th>Amount</th><td>Rwf ${s.amount.toFixed(2)}</td></tr>
              <tr><th>Category</th><td>${s.category}</td></tr>
              <tr><th>Reference Number</th><td>${s.reference_number}</td></tr>
              <tr><th>Expense Date</th><td>${new Date(s.expense_date).toLocaleDateString()}</td></tr>
              <tr><th>Status</th><td>${s.status}</td></tr>
              <tr><th>Created At</th><td>${new Date(s.created_at).toLocaleString()}</td></tr>
              <tr><th>Updated At</th><td>${new Date(s.updated_at).toLocaleString()}</td></tr>
            </table>
            <script>window.print(); window.close();<\/script>
          </body>
        </html>
      `),_.document.close())},C=()=>{const _=[...c].sort((D,$)=>new Date(D.created_at).getTime()-new Date($.created_at).getTime()).filter(D=>{const $=new Date(D.created_at),o=N?new Date(N):null,y=j?new Date(j):null;return o&&y?$>=o&&$<=y:o?$>=o:y?$<=y:!0}),A=window.open("","_blank");A&&(A.document.write(`
        <html>
          <head>
            <title>All Expense Transactions</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h2 { text-align: center; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>All Expense Transactions (${N||"Start"} to ${j||"End"})</h2>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Amount</th>
                  <th>Category</th>
                  <th>Reference Number</th>
                  <th>Expense Date</th>
                  <th>Status</th>
                  <th>Created At</th>
                  <th>Updated At</th>
                </tr>
              </thead>
              <tbody>
                ${_.map(D=>`
                      <tr>
                        <td>${D.id}</td>
                        <td>${D.title}</td>
                        <td>$${D.amount.toFixed(2)}</td>
                        <td>${D.category}</td>
                        <td>${D.reference_number}</td>
                        <td>${new Date(D.expense_date).toLocaleDateString()}</td>
                        <td>${D.status}</td>
                        <td>${new Date(D.created_at).toLocaleString()}</td>
                        <td>${new Date(D.updated_at).toLocaleString()}</td>
                      </tr>
                    `).join("")}
              </tbody>
            </table>
            <script>window.print(); window.close();<\/script>
          </body>
        </html>
      `),A.document.close())};return n.useEffect(()=>{u()},[]),e.jsxs("div",{className:"container mx-auto p-4 bg-gray-100 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Expense List"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("input",{type:"date",value:N,onChange:s=>b(s.target.value),className:"border p-2 rounded w-full",placeholder:"Start Date"}),e.jsx("input",{type:"date",value:j,onChange:s=>f(s.target.value),className:"border p-2 rounded w-full",placeholder:"End Date"}),e.jsx("button",{onClick:C,className:"bg-purple-500 text-white p-2 rounded hover:bg-purple-600",children:"Print All Transactions"})]})]}),e.jsxs("form",{onSubmit:a?l:t,className:"mb-6 bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Title",value:a?a.title:i.title,onChange:s=>a?p({...a,title:s.target.value}):h({...i,title:s.target.value}),className:"border p-2 rounded w-full",required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",value:a?a.amount:i.amount||"",onChange:s=>a?p({...a,amount:parseFloat(s.target.value)||0}):h({...i,amount:parseFloat(s.target.value)||0}),className:"border p-2 rounded w-full",required:!0}),e.jsx("input",{type:"text",placeholder:"Category",value:a?a.category:i.category,onChange:s=>a?p({...a,category:s.target.value}):h({...i,category:s.target.value}),className:"border p-2 rounded w-full",required:!0}),e.jsx("input",{type:"text",placeholder:"Reference Number",value:a?a.reference_number:i.reference_number,onChange:s=>a?p({...a,reference_number:s.target.value}):h({...i,reference_number:s.target.value}),className:"border p-2 rounded w-full",required:!0}),e.jsx("input",{type:"date",value:a?a.expense_date:i.expense_date,onChange:s=>a?p({...a,expense_date:s.target.value}):h({...i,expense_date:s.target.value}),className:"border p-2 rounded w-full",required:!0}),e.jsxs("select",{value:a?a.status:i.status,onChange:s=>a?p({...a,status:s.target.value}):h({...i,status:s.target.value}),className:"border p-2 rounded w-full",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-blue-500 text-white p-2 rounded hover:bg-blue-600",disabled:m,children:m?"Processing...":a?"Update Expense":"Add Expense"}),a&&e.jsx("button",{type:"button",onClick:()=>p(null),className:"bg-gray-500 text-white p-2 rounded hover:bg-gray-600",children:"Cancel"})]})]}),e.jsx("div",{className:"bg-white rounded shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Title"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Category"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Reference Number"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Expense Date"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Created At"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Updated At"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center py-4",children:"Loading..."})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center py-4",children:"No expenses found."})}):c.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:s.id}),e.jsx("td",{className:"px-4 py-2",children:s.title}),e.jsxs("td",{className:"px-4 py-2",children:[" ","Rwf ",s.amount.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2",children:s.category}),e.jsx("td",{className:"px-4 py-2",children:s.reference_number}),e.jsx("td",{className:"px-4 py-2",children:new Date(s.expense_date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-2",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-2",children:new Date(s.updated_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-sm ${s.status==="Approved"?"bg-green-100 text-green-800":s.status==="Rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:s.status})}),e.jsxs("td",{className:"px-4 py-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>p(s),className:"bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600",children:"Edit"}),e.jsx("button",{onClick:()=>S(s.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"Delete"}),e.jsx("button",{onClick:()=>d(s),className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"Print"})]})]},s.id))})]})})]})},_t=({icon:c,title:g,value:i,trend:h,bgColor:a="bg-blue-50",iconColor:p="text-blue-600"})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:g}),e.jsx("h3",{className:"text-2xl font-semibold mt-1",children:i})]}),e.jsx("div",{className:`h-12 w-12 ${a} rounded-full flex items-center justify-center`,children:e.jsx(c,{className:`h-6 w-6 ${p}`})})]}),e.jsxs("p",{className:"text-sm mt-4",children:[e.jsxs("span",{className:h>=0?"text-green-500":"text-red-500",children:[h>=0?"+":"",h,"%"]})," ","vs last month"]})]}),kt=()=>{const[c,g]=n.useState(0),[i,h]=n.useState(0),[a,p]=n.useState(0),[m,x]=n.useState([]),[N,b]=n.useState([]),[j,f]=n.useState([]),[u,t]=n.useState(!0),[l,S]=n.useState(""),[d,C]=n.useState(""),[s,_]=n.useState(null);n.useEffect(()=>{(async()=>{var y,w;try{const{data:v}=await k.auth.getSession(),E=(w=(y=v==null?void 0:v.session)==null?void 0:y.user)==null?void 0:w.id;if(E){const{data:P,error:R}=await k.from("users").select("role").eq("id",E).single();if(R)throw R;_((P==null?void 0:P.role)||null)}const{data:O}=await k.from("orders").select("total_amount, created_at, customer_email").order("created_at",{ascending:!1});if(O){const P=O.reduce((T,q)=>T+q.total_amount,0);g(P),h(O.length),b(O);const R=O.reduce((T,q)=>{const Z=new Date(q.created_at).toLocaleString("default",{month:"short"});return T[Z]=(T[Z]||0)+q.total_amount,T},{});x(Object.entries(R).map(([T,q])=>({month:T,amount:q})))}const{count:z}=await k.from("orders").select("customer_email",{count:"exact",head:!0}).not("customer_email","is",null);p(z||0);const{data:M}=await k.from("users").select("id, email, role, status, created_at");f(M||[]),t(!1)}catch(v){console.error("Error fetching dashboard data:",v),t(!1)}})()},[]);const A=[{icon:K,title:"Total Revenue",value:`Frw ${c.toLocaleString()}`,trend:12.5,bgColor:"bg-green-50",iconColor:"text-green-600"},{icon:X,title:"Total Customers",value:a.toLocaleString(),trend:8.1,bgColor:"bg-purple-50",iconColor:"text-purple-600"},{icon:ae,title:"Total Orders",value:i.toLocaleString(),trend:-3.2,bgColor:"bg-orange-50",iconColor:"text-orange-600"},{icon:re,title:"Growth Rate",value:"15.2%",trend:4.8,bgColor:"bg-blue-50",iconColor:"text-blue-600"}],D=()=>{const o=N.filter(P=>{const R=new Date(P.created_at),T=l?new Date(l):null,q=d?new Date(d):null;return T&&q?R>=T&&R<=q:T?R>=T:q?R<=q:!0}),y=o.reduce((P,R)=>P+R.total_amount,0),w=o.length,v=new Set(o.map(P=>P.customer_email).filter(Boolean)).size,E=["Metric","Value","Trend vs Last Month","Details"].join(","),O=[`Total Revenue (Filtered),Frw ${y.toLocaleString()},${A[0].trend}%,`,`Total Customers (Filtered),${v},${A[1].trend}%,`,`Total Orders (Filtered),${w},${A[2].trend}%,`,`Growth Rate,${A[3].value},${A[3].trend}%,`,...o.map(P=>`Order,Frw ${P.total_amount.toLocaleString()},,Created At: ${new Date(P.created_at).toLocaleString()}, Customer: ${P.customer_email||"N/A"}`)].join(`
`),z=`${E}
${O}`,M=new Blob([z],{type:"text/csv;charset=utf-8;"});Se.saveAs(M,`admin_report_${l||"start"}_to_${d||"end"}.csv`)},$=async(o,y,w)=>{if(s!=="supa-admin"){alert("Only users with the role 'supa-admin' can modify user status.");return}const v=y==="active"?"inactive":"active";try{const{error:E}=await k.from("users").update({status:v}).eq("id",o);if(E)throw E;f(j.map(O=>O.id===o?{...O,status:v}:O)),v==="inactive"&&console.log(`Sending email to ${w}: Your account has been deactivated. Please contact the admin.`)}catch(E){console.error("Error updating user status:",E)}};return u?e.jsx("div",{className:"flex items-center justify-center h-full",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Admin Dashboard"}),e.jsx("div",{className:"flex space-x-4",children:s==="supa-admin"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:l,onChange:o=>S(o.target.value),className:"border p-2 rounded w-full",placeholder:"Start Date"}),e.jsx("input",{type:"date",value:d,onChange:o=>C(o.target.value),className:"border p-2 rounded w-full",placeholder:"End Date"}),e.jsx("button",{onClick:D,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Download Report"})]}):e.jsx("p",{className:"text-red-600",children:"Only 'supa-admin' users can download reports."})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:A.map((o,y)=>e.jsx(_t,{...o},y))}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Sales Overview"}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(fe,{data:m,children:[e.jsx(ye,{strokeDasharray:"3 3"}),e.jsx(be,{dataKey:"month"}),e.jsx(je,{}),e.jsx(we,{}),e.jsx(Ne,{}),e.jsx(ve,{dataKey:"amount",name:"Sales",fill:"#4F46E5"})]})})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"User Management"}),s==="supa-admin"?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.role}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.status}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>$(o.id,o.status,o.email),className:`px-4 py-2 rounded ${o.status==="active"?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:o.status==="active"?"Inactive":"Active"})})]},o.id))})]})}):e.jsx("p",{className:"text-red-600",children:"Only 'supa-admin' users can manage user accounts."})]})]})},At=()=>{const{user:c,loading:g}=V();return g?e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Loading..."}):c?e.jsx(xe,{}):e.jsx(te,{to:"/login",replace:!0})};function Et(){return e.jsxs(We,{children:[e.jsx(F,{element:e.jsx(At,{}),children:e.jsxs(F,{element:e.jsx(mt,{}),children:[e.jsx(F,{path:"/dashboard",element:e.jsx(nt,{})}),e.jsx(F,{path:"/sales-dashboard",element:e.jsx(gt,{})}),e.jsx(F,{path:"/admin-dashboard",element:e.jsx(xt,{})}),e.jsx(F,{path:"/admin-management",element:e.jsx(kt,{})})," ",e.jsx(F,{path:"/companies",element:e.jsx(ft,{})}),e.jsx(F,{path:"/product-list",element:e.jsx(yt,{})}),e.jsx(F,{path:"/add-product",element:e.jsx(bt,{})}),e.jsx(F,{path:"/expired-products",element:e.jsx(jt,{})}),e.jsx(F,{path:"/low-stocks",element:e.jsx(wt,{})}),e.jsx(F,{path:"/category-list",element:e.jsx(Nt,{})}),e.jsx(F,{path:"/manage-stocks",element:e.jsx(vt,{})}),e.jsx(F,{path:"/online-orders",element:e.jsx(St,{})}),e.jsx(F,{path:"/sales-returns",element:e.jsx(Ct,{})}),e.jsx(F,{path:"/expense-list",element:e.jsx(Dt,{})})]})}),e.jsx(F,{path:"/login",element:e.jsx(st,{})}),e.jsx(F,{path:"/signup",element:e.jsx(rt,{})}),e.jsx(F,{path:"/",element:e.jsx(te,{to:"/login",replace:!0})}),e.jsx(F,{path:"*",element:e.jsx(te,{to:"/login",replace:!0})})]})}function Pt(){return e.jsx(tt,{children:e.jsx(Qe,{children:e.jsx(Et,{})})})}Xe.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(Pt,{})}));
